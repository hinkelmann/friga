{% extends 'base.admin.html.twig' %}
{% block titulo %} Edital N° {{ frigaedital.titulo }}{% endblock %}
{% block breadcumbsTitulo %}Configuração de Edital {% endblock %}
{% block conteudo %}
    <div class="row">
       {{ include('@NteAplicacaoFriga/edital/menu.html.twig', {entidade: frigaedital}) }}
        <div class="col-md-10">
            <div class="row">
                <div class="col-md-6">
                    <div id="jsGrid"></div>
                </div>
                <div class="col-md-4">
                    <div id="arquivo-edital" class="dropzone"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts2 %}
    <script src="{{ asset('assets/vendor/dropzone/dropzone.min.js') }}"></script>
    <script src="{{ asset('assets/vendor/moment/moment.min.js') }}"></script>
    <script src="{{ asset('assets/vendor/moment/locales.min.js') }}"></script>
    <script src="{{ asset('assets/vendor/bootstrap-datetimepicker/pt-br.js') }}"></script>
    <script src="{{ asset('assets/vendor/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js') }}"></script>

    <link type="text/css" rel="stylesheet" href="{{ asset('assets/vendor/sweetalert2/dist/sweetalert2.min.css') }}"/>
    <link type="text/css" rel="stylesheet" href="{{ asset('assets/vendor/datatables/datatables.min.css') }}"/>
    <script type="text/javascript" src="{{ asset('assets/vendor/datatables/datatables.min.js') }}"></script>
    <script src="{{ asset('assets/vendor/sweetalert2/dist/sweetalert2.min.js') }}"></script>
    <script>

        //DropZone
        Dropzone.autoDiscover = false;
        Dropzone.prototype.defaultOptions.acceptedFiles = "image/*,application/pdf";
        Dropzone.prototype.defaultOptions.maxFilesize = 10;
        Dropzone.prototype.defaultOptions.headers = {'x-contexto': "EDITAL", "x-id": {{ frigaedital.id }} };
        Dropzone.prototype.defaultOptions.dictFileTooBig = "O arquivo escolhido excede o tamanho máximo permitido (10Mb). Reduza o arquivo e tente novamente";
        Dropzone.prototype.defaultOptions.dictInvalidFileType = "O arquivo escolhido não é do tipo  imagem ou PDF. Escolha outro arquivo e tente novamente.";
        Dropzone.prototype.defaultOptions.init = function () {
            /*this.on("sending", function (file, xhr, formData) {
                //      formData.append("xtk", "{{ csrf_token('friga-upload-edital-form') }}");
            });*/
            this.on("success", function (file) {
                if (jQuery.parseJSON(file.xhr.response).error) {
                    new PNotify({
                        text: jQuery.parseJSON(file.xhr.response).message,
                        type: 'error',
                        addclass: 'notification-error',
                        icon: 'fa fa-2x fa-exclamation-triangle'
                    });
                    this.removeFile(file);
                } else {
                    new PNotify({
                        title: "Envio de arquivo",
                        text: "Arquivo enviado com sucesso!",
                        type: 'success',
                        addclass: 'notification-success',
                        icon: 'fa fa-2x fa-exclamation-triangle'
                    });
                    this.removeFile(file);
                }
                $("#jsGrid").jsGrid("loadData");
            });
            this.on('error', function (file, errorMessage, XMLHttpRequest) {
                new PNotify({
                    text: (XMLHttpRequest.status == 500 ? "Arquivo não aceito" : errorMessage),
                    type: 'error',
                    addclass: 'notification-error',
                    icon: 'fa fa-2x fa-exclamation-triangle'
                });
                this.removeFile(file);
            })
        };
        new Dropzone("#arquivo-edital", {
            url: "{{ oneup_uploader_endpoint('frigadata') }}",
            dictDefaultMessage: "<i class='fa fa-2x fa-upload'></i><br> Anexar arquivo relativo ao edital",
        });


    </script>

{% endblock %}
