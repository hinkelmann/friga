{% extends 'base.admin.html.twig' %}
{% block titulo %} Edital N° {{ frigaedital.titulo }}{% endblock %}
{% block breadcumbsTitulo %}Avaliadores {% endblock %}
{% block conteudo %}
    <div class="row">
        {{ include('@NteAplicacaoFriga/edital/menu.html.twig', {entidade: frigaedital}) }}
        <div class="col-md-10">
            <section class="panel-body">
                {% if frigaedital.pontuacaoCategoria|length %}
                    <div class="text-right">
                        <div class="btn-group btn-group-sm ">
                            <a href="#"
                               title="Clique aqui para importar a pontuação de outro edital"
                               class="btn btn-primary importar">
                                <i class="fa fa-cloud-download"></i> Importar
                            </a>
                            <a href="{{ path('edital_pontuacao_categoria_peso_criar',{uuid: frigaedital.uuid}) }}"
                               class="btn btn-default ">
                                <i class="fa fa-balance-scale"></i> Peso
                            </a>
                            <a href="{{ path('edital_pontuacao_categoria_criar',{uuid: frigaedital.uuid}) }}"
                               class="btn btn-default ">
                                <i class="fa fa-plus-circle"></i> Categoria
                            </a>
                            <a href="{{ path('edital_pontuacao_criar',{uuid: frigaedital.uuid}) }}"
                               class="btn btn-default ">
                                <i class="fa fa-plus-circle"></i> Pontuação
                            </a>

                        </div>
                    </div>
                    <table class="table table-hover table-condesed ">
                        <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Etapa</th>
                            <th>Item</th>
                            <th>valor</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for categoria in frigaedital.pontuacaoCategoria if categoria.idCategoria != null %}
                            <tr>
                                <td rowspan="{{ categoria.pontuacao|length +1 }}">
                                    <a href="{{ path('edital_pontuacao_categoria_editar', {'pontuacaoCategoria': categoria.id, 'uuid': frigaedital.uuid}) }}">
                                        {{ categoria.descricao }}
                                    </a>
                                </td>
                                <td rowspan="{{ categoria.pontuacao|length +1 }}">{{ categoria.valorMaximo }}</td>
                                {% if categoria.pontuacao|length == 0 %}
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right">
                                        <a href="{{ path('edital_pontuacao_categoria_remover', {'pontuacaoCategoria': categoria.id, 'uuid': frigaedital.uuid}) }}">X</a>
                                    </td>
                                {% endif %}
                            </tr>
                            {% if categoria.pontuacao|length %}
                                {% for p in categoria.pontuacao %}
                                    <tr>
                                        <td>
                                            {% for e in p.idEtapa %}
                                                {{ e.descricao }}{% if not loop.last %}<br> {% endif %}
                                            {% endfor %}
                                        </td>
                                        <td>
                                            <a href="{{ path('edital_pontuacao_editar', {'pontuacao': p.id, 'uuid': frigaedital.uuid}) }}">
                                                {{ p.titulo }}
                                            </a>
                                        </td>
                                        <td>{{ p.valorMaximo }}</td>
                                        <td class="text-right">
                                            <a href="{{ path('edital_pontuacao_remover', {'pontuacao': p.id, 'uuid': frigaedital.uuid}) }}">X</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}

                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <section class="body-error error-inside">
                        <div class="center-error">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="main-error mb-xlg">
                                        <h2 class="error-code text-dark text-center text-weight-semibold m-none">
                                            <i class="fa fa-calculator text-primary"></i>
                                        </h2>
                                        <p class="error-explanation text-center text-primary">
                                            <br><b>Nenhuma pontuação disponível para este edital </b> até o
                                            momento.<br>
                                            <br>
                                            <br>
                                            <a href="{{ path('edital_pontuacao_categoria_peso_criar',{uuid: frigaedital.uuid}) }}"
                                               class="btn btn-primary">
                                                <i class="fa fa-plus-circle"></i> Adicionar Peso
                                            </a>

                                            <a href="#"
                                               title="Clique aqui para importar a pontuação de outro edital"
                                               class="btn btn-primary importar">
                                                <i class="fa fa-cloud-download"></i> Importar
                                            </a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                {% endif %}
            </section>
            <br><br>
            <div class="panel">
                <div class="panel-body">
                    <b class="pull-left">Cálculo da pontuação:
                        {% for categoria in frigaedital.pontuacaoCategoria %}
                            {% if categoria.idCategoria == null %}
                                <a href="{{ path('edital_pontuacao_categoria_peso_editar', {'pontuacaoCategoria': categoria.id, 'uuid': frigaedital.uuid}) }}">({{ categoria.descricao }}
                                    x {{ categoria.valorMaximo +0 }} )</a>
                                {% if not loop.last %}
                                    +
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        =
                        (Pontuação Total)
                    </b>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts2 %}
<script src="{{ asset('assets/vendor/sweetalert2/dist/sweetalert2.all.min.js') }}"></script>
    <script>
        $('.importar').click(e=>{
            Swal.fire({
                //title: 'Importar Etaoas',
                html:'<div><select id="edital" class="form-control" required>'
                        {% for edital in editais %}+ '<option value="{{ edital.id }}">{{ edital.titulo }}</option>' {% endfor %}
                    + '</select></div><br>',
                //type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#ccc',
                confirmButtonText: 'Importar',
                cancelButtonText: "Cancelar"
            }).then(function (result) {
                if (result.value) {
                    window.location = "{{ path('edital_clone_pontuacao',{'destino':frigaedital.id}) }}/"+document.getElementById('edital').value;
                    // $.post().done();
                }
            });
        })
    </script>
{% endblock %}
